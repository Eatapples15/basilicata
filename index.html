<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestione Colori Criticità</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            padding: 20px;
        }

        #color-controls {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 20px;
            border: 1px solid #ccc;
        }

        .color-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .color-input-group label {
            width: 50px;
        }

        #save-colors {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        }

        #save-colors:hover {
            background-color: #45a049;
        }

        .error-message {
            color: red;
            font-size: 0.8em;
        }
    </style>
</head>

<body>

    <div id="color-controls">
        <h2>Imposta Colori Criticità</h2>

        <div class="color-input-group">
            <label for="color-A1">A1:</label>
            <select id="color-A1">
                <option value="green">Verde</option>
                <option value="yellow">Giallo</option>
                <option value="orange">Arancione</option>
                <option value="red">Rosso</option>
            </select>
            <span class="error-message" id="error-A1"></span>
        </div>
        <div class="color-input-group">
            <label for="color-A2">A2:</label>
            <select id="color-A2">
                <option value="green">Verde</option>
                <option value="yellow">Giallo</option>
                <option value="orange">Arancione</option>
                <option value="red">Rosso</option>
            </select>
            <span class="error-message" id="error-A2"></span>
        </div>
        <div class="color-input-group">
            <label for="color-E2">E2:</label>
            <select id="color-E2">
                <option value="green">Verde</option>
                <option value="yellow">Giallo</option>
                <option value="orange">Arancione</option>
                <option value="red">Rosso</option>
            </select>
            <span class="error-message" id="error-E2"></span>
        </div>

        <button id="save-colors">Salva Colori</button>
    </div>

    <script>
        function validateColors() {
            let isValid = true;
            const colors = ['green', 'yellow', 'orange', 'red'];

            document.querySelectorAll('select').forEach(select => {
                const color = select.value;
                const errorSpan = document.getElementById(`error-${select.id.split('-')[1]}`);
                if (!colors.includes(color)) {
                    errorSpan.textContent = "Colore non valido";
                    isValid = false;
                } else {
                    errorSpan.textContent = "";
                }
            });

            return isValid;
        }

        function saveColors() {
            if (!validateColors()) {
                alert("Correggi gli errori nei colori!");
                return;
            }

            const coloriBase = {};
            document.querySelectorAll('select').forEach(select => {
                const base = select.id.split('-')[1];
                coloriBase[base] = select.value;
            });

            // Save colors to localStorage (or send to server)
            localStorage.setItem('coloriBase', JSON.stringify(coloriBase));

            // Optionally, also save the GeoJSON data if needed in visualizza.html
            fetch('limits_R_17_municipalities.geojson')
                .then(response => response.json())
                .then(data => {
                    localStorage.setItem('geojsonData', JSON.stringify(data));
                    window.location.href = 'visualizza.html'; // Redirect to the map page
                })
                .catch(error => console.error("Errore nel caricamento del GeoJSON:", error));
        }

        document.getElementById('save-colors').addEventListener('click', saveColors);
    </script>
</body>

</html>
